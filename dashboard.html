<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appointmentix Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400;500;700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <header class="topbar">
    <a class="brand" href="/">
      <span class="dot"></span>
      <span>APPOINTMENTIX</span>
    </a>
    <div class="topbar-actions">
      <span id="sessionLabel" class="session-label">Nicht angemeldet</span>
      <button id="logoutBtn" class="btn ghost hidden" type="button">Abmelden</button>
    </div>
  </header>

  <main class="shell">
    <section id="authSection" class="card auth-card">
      <h1>Web Dashboard Login</h1>
      <p class="subline">Melde dich mit deinem Klinik-Konto an oder erstelle ein Owner-Konto.</p>

      <div class="tabs">
        <button id="tabLogin" class="tab active" type="button">Login</button>
        <button id="tabRegister" class="tab" type="button">Registrieren</button>
      </div>

      <form id="loginForm" class="form">
        <label>E-Mail
          <input name="email" type="email" placeholder="du@klinik.de" required>
        </label>
        <label>Passwort
          <input name="password" type="password" minlength="8" required>
        </label>
        <button class="btn primary" type="submit">Einloggen</button>
      </form>

      <form id="registerForm" class="form hidden">
        <label>Vollst√§ndiger Name
          <input name="fullName" type="text" minlength="2" required>
        </label>
        <label>Klinikname
          <input name="clinicName" type="text" minlength="2" required>
        </label>
        <label>E-Mail
          <input name="email" type="email" placeholder="owner@klinik.de" required>
        </label>
        <label>Passwort
          <input name="password" type="password" minlength="8" required>
        </label>
        <button class="btn primary" type="submit">Owner-Konto erstellen</button>
      </form>

      <p id="authMessage" class="message"></p>
    </section>

    <section id="dashboardSection" class="hidden">
      <div class="grid metrics-grid">
        <article class="card analytics-dashboard">
          <div class="analytics-layout">
            <aside class="analytics-sidebar">
              <div class="analytics-logo">
                <span class="dot"></span>
                <strong>APPOINTMENTIX</strong>
              </div>
              <button class="side-nav-item active" type="button" data-nav-target="dashboardTop">Start</button>
              <button class="side-nav-item" type="button" data-nav-target="clinicProfilesSection">Kundenprofile</button>
              <button class="side-nav-item" type="button" data-nav-target="shopSummarySection">Shop-√úbersicht</button>
              <button class="side-nav-item" type="button" data-nav-target="membershipsSection">Mitgliedschaften</button>
              <button class="side-nav-item" type="button" data-nav-target="appBuilderSection">App-Builder</button>
              <button class="side-nav-item" type="button" data-nav-target="campaignsSection">Kampagnen</button>
            </aside>

            <div id="dashboardTop" class="analytics-main">
              <div class="analytics-headline">
                <h2 id="dashboardGreeting">Guten Morgen üëã</h2>
                <div class="inline-actions">
                  <button class="btn ghost" type="button">QR scannen</button>
                </div>
              </div>

              <div class="hero-grid">
                <section class="analytics-tile hero-chart">
                  <div class="tile-top">
                    <div>
                      <p class="tile-label">Tagesumsatz</p>
                      <p id="metricDailyProcessingValue" class="tile-value">‚Ç¨0.00</p>
                    </div>
                    <div class="inline-actions">
                      <p id="metricDailyProcessingDelta" class="delta-badge">+0.0%</p>
                      <button class="icon-btn" type="button" data-export-kind="dailyProcessing" title="CSV exportieren">‚§ì</button>
                    </div>
                  </div>
                  <canvas id="chartDailyProcessing" height="130"></canvas>
                </section>

                <section class="analytics-tile hero-feed">
                  <div class="tile-top">
                    <h3>Live-Aktivit√§tsfeed</h3>
                  </div>
                  <ul id="liveActivityBody" class="activity-list"></ul>
                </section>
              </div>

              <div class="stats-toolbar">
                <h3>Statistiken</h3>
                <div id="metricsChipRow" class="metrics-chip-row">
                  <button class="chip-filter-btn" type="button" data-days="7">7 Tage</button>
                  <button class="chip-filter-btn active" type="button" data-days="30">30 Tage</button>
                  <button class="chip-filter-btn" type="button" data-days="90">90 Tage</button>
                  <button class="chip-filter-btn" type="button" data-days="all">Alle Zeit</button>
                </div>
                <div class="inline-actions">
                  <select id="metricsDaysSelect" class="hidden">
                    <option value="7">7 Tage</option>
                    <option value="30" selected>30 Tage</option>
                    <option value="90">90 Tage</option>
                    <option value="all">Alle Zeit</option>
                  </select>
                  <div class="metrics-range-controls">
                    <input id="metricsFromDate" type="date" aria-label="Von Datum">
                    <span>bis</span>
                    <input id="metricsToDate" type="date" aria-label="Bis Datum">
                    <button id="metricsApplyRangeBtn" class="btn ghost" type="button">√úbernehmen</button>
                  </div>
                  <select id="metricsCompareSelect">
                    <option value="none" selected>Kein Vergleich</option>
                    <option value="prev">Vormonat</option>
                    <option value="yoy">Vorjahr</option>
                  </select>
                  <button id="refreshMetricsBtn" class="btn ghost" type="button">Aktualisieren</button>
                </div>
              </div>
              <p id="metricsDateRangeLabel" class="metrics-date-range">Zeitraum: -</p>

              <div class="stats-grid">
                <section id="shopSummarySection" class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Nettoumsatz</p>
                    <button class="icon-btn" type="button" data-export-kind="netRevenue" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricNetRevenueValue" class="tile-value">‚Ç¨0.00</p>
                  <p id="metricNetRevenueDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartNetRevenue" height="110"></canvas>
                </section>

                <section id="membershipsSection" class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">MRR</p>
                    <button class="icon-btn" type="button" data-export-kind="mrr" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricMRRValue" class="tile-value">‚Ç¨0.00</p>
                  <p id="metricMRRDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartMRR" height="110"></canvas>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Umsatzquellen</p>
                    <button class="icon-btn" type="button" data-export-kind="revenueSources" title="CSV exportieren">‚§ì</button>
                  </div>
                  <div id="revenueSourcesBar" class="revenue-stack"></div>
                  <div id="revenueSourcesBody" class="source-list"></div>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">LTV pro App-Nutzer</p>
                    <button class="icon-btn" type="button" data-export-kind="appUserLtv" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricAppUserLTVValue" class="tile-value">‚Ç¨0.00</p>
                  <p id="metricAppUserLTVDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartAppUserLTV" height="110"></canvas>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Kunden-LTV</p>
                    <button class="icon-btn" type="button" data-export-kind="clientLtv" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricClientLTVValue" class="tile-value">‚Ç¨0.00</p>
                  <p id="metricClientLTVDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartClientLTV" height="110"></canvas>
                </section>

                <section id="clinicProfilesSection" class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Top-Kunden</p>
                    <button class="icon-btn" type="button" data-export-kind="topClients" title="CSV exportieren">‚§ì</button>
                  </div>
                  <div class="table-wrap tight">
                    <table>
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Monatlicher Umsatz</th>
                        </tr>
                      </thead>
                      <tbody id="topClientsBody"></tbody>
                    </table>
                  </div>
                </section>

                <section id="appBuilderSection" class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Top-Teammitglieder</p>
                    <button class="icon-btn" type="button" data-export-kind="topTeam" title="CSV exportieren">‚§ì</button>
                  </div>
                  <div class="table-wrap tight">
                    <table>
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Umsatz</th>
                        </tr>
                      </thead>
                      <tbody id="topTeamBody"></tbody>
                    </table>
                  </div>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">App-Nutzer</p>
                    <button class="icon-btn" type="button" data-export-kind="appUsers" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricAppUsersValue" class="tile-value">0</p>
                  <p id="metricAppUsersDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartAppUsers" height="110"></canvas>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Empfehlungen</p>
                    <button class="icon-btn" type="button" data-export-kind="referrals" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricReferralsValue" class="tile-value">0</p>
                  <p id="metricReferralsDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartReferrals" height="110"></canvas>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Besuche</p>
                    <button class="icon-btn" type="button" data-export-kind="visits" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricVisitsValue" class="tile-value">0</p>
                  <p id="metricVisitsDelta" class="delta-inline hidden">+0.0%</p>
                  <canvas id="chartVisits" height="110"></canvas>
                </section>

                <section class="analytics-tile">
                  <div class="tile-top">
                    <p class="tile-label">Google-Bewertungen</p>
                    <button class="icon-btn" type="button" data-export-kind="reviews" title="CSV exportieren">‚§ì</button>
                  </div>
                  <p id="metricReviewsValue" class="tile-value">0</p>
                  <canvas id="chartReviews" height="110"></canvas>
                </section>
              </div>
            </div>
          </div>
        </article>
      </div>

      <div id="clinicSettingsSection" class="grid">
        <article class="card">
          <h2>Klinik-Einstellungen</h2>
          <p class="subline">Branding und Basisdaten deiner Klinik.</p>

          <form id="settingsForm" class="form">
            <label>Klinikname
              <input name="clinicName" type="text" required>
            </label>
            <label>Website
              <input name="website" type="text" placeholder="https://deine-klinik.de">
            </label>
            <label>Logo URL
              <input name="logoUrl" type="text" placeholder="https://...">
            </label>
            <div class="row-2">
              <label>Markenfarbe
                <input name="brandColor" type="text" placeholder="#16A34A">
              </label>
              <label>Akzentfarbe
                <input name="accentColor" type="text" placeholder="#EB6C13">
              </label>
            </div>
            <label>Schriftart
              <input name="fontFamily" type="text" placeholder="Gabarito, DM Sans, sans-serif">
            </label>
            <label>Design-Preset
              <select name="designPreset">
                <option value="clean">clean</option>
                <option value="bold">bold</option>
                <option value="minimal">minimal</option>
              </select>
            </label>
            <label>Calendly URL
              <input name="calendlyUrl" type="text" placeholder="https://calendly.com/...">
            </label>
            <button id="saveSettingsBtn" class="btn primary" type="submit">Einstellungen speichern</button>
          </form>
        </article>

        <article class="card">
          <h2>Team-Mitglieder</h2>
          <p class="subline">Owner kann Staff-User anlegen.</p>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>E-Mail</th>
                  <th>Rolle</th>
                </tr>
              </thead>
              <tbody id="membersBody"></tbody>
            </table>
          </div>

          <form id="memberForm" class="form">
            <label>Name
              <input name="fullName" type="text" minlength="2" required>
            </label>
            <label>E-Mail
              <input name="email" type="email" required>
            </label>
            <label>Passwort
              <input name="password" type="password" minlength="8" required>
            </label>
            <button class="btn primary" type="submit">Staff anlegen</button>
          </form>
        </article>
      </div>

      <div id="billingSection" class="grid billing-grid">
        <article class="card">
          <h2>Billing-Status</h2>
          <div id="billingStatus" class="kv-list"></div>
          <button id="startCheckoutBtn" class="btn primary" type="button">Stripe-Checkout √∂ffnen</button>
        </article>

        <article class="card">
          <h2>Subscription-Historie</h2>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Plan</th>
                  <th>Status</th>
                  <th>Betrag</th>
                  <th>Update</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
          </div>
        </article>
      </div>

      <div id="catalogSection" class="grid metrics-grid">
        <article class="card catalog-card">
          <div class="section-head">
            <div>
              <h2>Katalog-Editor</h2>
              <p class="subline">Pflege Treatments, Mitgliedschaften, Belohnungen und Home-Content ohne Code.</p>
            </div>
            <div class="inline-actions">
              <a class="btn ghost" href="/catalog">Visueller Editor</a>
              <button id="exportCatalogBtn" class="btn ghost" type="button">Katalog exportieren</button>
              <input id="importCatalogInput" class="hidden" type="file" accept="application/json">
              <button id="importCatalogBtn" class="btn ghost" type="button">Katalog importieren</button>
              <button id="saveCatalogBtn" class="btn primary" type="button">Katalog speichern</button>
            </div>
          </div>

          <form id="catalogForm" class="catalog-grid">
            <section class="catalog-block">
              <div class="catalog-head">
                <h3>Kategorien</h3>
                <button id="addCategoryBtn" class="btn ghost btn-sm" type="button">+ Kategorie</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Label</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="categoriesBody"></tbody>
                </table>
              </div>
            </section>

            <section class="catalog-block">
              <div class="catalog-head">
                <h3>Treatments</h3>
                <button id="addTreatmentBtn" class="btn ghost btn-sm" type="button">+ Treatment</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Kategorie</th>
                      <th>Preis (Cent)</th>
                      <th>Member (Cent)</th>
                      <th>Min</th>
                      <th>Beschreibung</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="treatmentsBody"></tbody>
                </table>
              </div>
            </section>

            <section class="catalog-block">
              <div class="catalog-head">
                <h3>Mitgliedschaften</h3>
                <button id="addMembershipBtn" class="btn ghost btn-sm" type="button">+ Membership</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Preis (Cent)</th>
                      <th>Inkl. Treatment IDs (Komma)</th>
                      <th>Perks (Komma)</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="membershipsBody"></tbody>
                </table>
              </div>
            </section>

            <section class="catalog-block">
              <div class="catalog-head">
                <h3>Reward Aktionen</h3>
                <button id="addRewardActionBtn" class="btn ghost btn-sm" type="button">+ Aktion</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Label</th>
                      <th>Punkte</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="rewardActionsBody"></tbody>
                </table>
              </div>
            </section>

            <section class="catalog-block">
              <div class="catalog-head">
                <h3>Reward Einl√∂sungen</h3>
                <button id="addRewardRedeemBtn" class="btn ghost btn-sm" type="button">+ Einl√∂sung</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Label</th>
                      <th>Ben√∂tigte Punkte</th>
                      <th>Wert (Cent)</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="rewardRedeemsBody"></tbody>
                </table>
              </div>
            </section>

            <section class="catalog-block">
              <div class="catalog-head">
                <h3>Home Artikel</h3>
                <button id="addHomeArticleBtn" class="btn ghost btn-sm" type="button">+ Artikel</button>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Tag</th>
                      <th>Titel</th>
                      <th>Text</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="homeArticlesBody"></tbody>
                </table>
              </div>
            </section>
          </form>
        </article>
      </div>

      <div id="campaignsSection" class="grid">
        <article class="card">
          <div class="section-head">
            <div>
              <h2>Kampagnen (Automation v1)</h2>
              <p class="subline">Lege Trigger-Kampagnen an und starte sie manuell.</p>
            </div>
            <div class="inline-actions">
              <button id="runDueCampaignsBtn" class="btn ghost" type="button">F√§llige ausf√ºhren</button>
              <button id="refreshCampaignsBtn" class="btn ghost" type="button">Aktualisieren</button>
            </div>
          </div>

          <form id="campaignForm" class="form">
            <div class="row-2">
              <label>Name
                <input name="name" type="text" placeholder="Winback 30 Tage" required>
              </label>
              <label>Trigger
                <select name="triggerType">
                  <option value="broadcast">broadcast</option>
                  <option value="inactive_30d">inactive_30d</option>
                  <option value="abandoned_cart_24h">abandoned_cart_24h</option>
                  <option value="membership_past_due">membership_past_due</option>
                  <option value="membership_canceled_winback">membership_canceled_winback</option>
                </select>
              </label>
            </div>
            <div class="row-2">
              <label>Kanal
                <select name="channel">
                  <option value="in_app">in_app</option>
                  <option value="push">push</option>
                  <option value="email">email</option>
                  <option value="sms">sms</option>
                </select>
              </label>
              <label>Status
                <select name="status">
                  <option value="draft">draft</option>
                  <option value="active">active</option>
                  <option value="paused">paused</option>
                </select>
              </label>
            </div>
            <label>Titel
              <input name="templateTitle" type="text" placeholder="Wir vermissen dich in der Klinik">
            </label>
            <label>Nachricht
              <input name="templateBody" type="text" placeholder="Buche jetzt und erhalte Bonuspunkte.">
            </label>
            <label>Bonuspunkte
              <input name="pointsBonus" type="number" min="0" step="1" value="0">
            </label>
            <button id="createCampaignBtn" class="btn primary" type="submit">Kampagne erstellen</button>
          </form>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Trigger</th>
                  <th>Status</th>
                  <th>L√§uft</th>
                  <th>Zielgruppe gesamt</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="campaignsBody"></tbody>
            </table>
          </div>
        </article>

        <article class="card">
          <div class="section-head">
            <div>
              <h2>Audit-Log</h2>
              <p class="subline">Wer hat was ge√§ndert und wann.</p>
            </div>
            <button id="refreshAuditBtn" class="btn ghost" type="button">Aktualisieren</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Zeit</th>
                  <th>Aktion</th>
                  <th>Objekt</th>
                  <th>User</th>
                </tr>
              </thead>
              <tbody id="auditLogsBody"></tbody>
            </table>
          </div>
        </article>
      </div>
    </section>

    <div id="toast" class="toast"></div>
  </main>

  <script src="dashboard.js"></script>
</body>
</html>
